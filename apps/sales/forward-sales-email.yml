name: airtable-contacted-interest-email
apiRevision: edurata.io/v1
description: |
  Lookup Airtable leads with status "Kontaktiert Interesse", no Email Status, and a decision‚Äëmaker name present. For each, generate a personalized email from a template (stored in Google Docs) and send via Gmail API.
interface:
  inputs:
    airtable_id:
      type: string
  required:
steps:
  list-leads-initial:
    description: Retrieve leads with no Email Status and contacted today
    source:
      repoUrl: https://github.com/Edurata/edurata-functions.git
      path: general/axios
    props:
      method: GET
      url: "https://api.airtable.com/v0/${inputs.airtable_id}"
      headers:
        Authorization: "Bearer ${secrets.AIRTABLE_API_KEY}"
      params:
        filterByFormula: "AND({Lead Status} = 'Kontaktiert Interesse', {Email Status} = '', {Name Entscheider} != '', {Kontaktiert} = TODAY())"
      maxResults: 100
  list-leads-first-followup:
    description: Retrieve leads with Email Status '1. Verschickt' and contacted 3 days ago
    source:
      repoUrl: https://github.com/Edurata/edurata-functions.git
      path: general/axios
    props:
      method: GET
      url: "https://api.airtable.com/v0/${inputs.airtable_id}"
      headers:
        Authorization: "Bearer ${secrets.AIRTABLE_API_KEY}"
      params:
        filterByFormula: "AND({Lead Status} = 'Kontaktiert Interesse', {Email Status} = '1. Verschickt', {Name Entscheider} != '', {Kontaktiert} = TODAY() - 3)"
      maxResults: 100
  list-leads-second-followup:
    description: Retrieve leads with Email Status '2. Verschickt' and contacted 3 days ago
    source:
      repoUrl: https://github.com/Edurata/edurata-functions.git
      path: general/axios
    props:
      method: GET
      url: "https://api.airtable.com/v0/${inputs.airtable_id}"
      headers:
        Authorization: "Bearer ${secrets.AIRTABLE_API_KEY}"
      params:
        filterByFormula: "AND({Lead Status} = 'Kontaktiert Interesse', {Email Status} = '2. Verschickt', {Name Entscheider} != '', {Kontaktiert} = TODAY() - 3)"
      maxResults: 100
  send-initial-email:
    foreach: ${list-leads-initial.response.records}
    description: Send initial email to leads contacted today
    source:
      repoUrl: https://github.com/Edurata/edurata-functions.git
      path: etl/load/send-gmail-email
    props:
      GMAIL_API_KEY: ${secrets.G_MAIL}
      userEmail: juliandemourgues@edurata.com
      recipient: ${each.Email}
      subject: "Wie versprochen ‚Äì Einblicke & unser Modell"
      body: |
        <!DOCTYPE html>
          <html lang="de">
          <head>
            <meta charset="utf-8">
            <title>Wie versprochen ‚Äì Einblicke & unser Modell</title>
          </head>
          <body style="font-family: Arial, sans-serif; font-size: 14px; line-height: 1.6; color: #000;">
            <p><strong>Betreff:</strong> Wie versprochen ‚Äì Einblicke &amp; unser Modell</p>

            <p>Hallo ${each.Name Entscheider},</p>

            <p>
              vielen Dank nochmal f√ºr das Gespr√§ch! Anbei wie angek√ºndigt unsere kurze Pr√§sentation
              mit Beispielen aus der Praxis.
            </p>

            <p>
              Was uns von anderen unterscheidet ‚Äì kurz zusammengefasst
              (mehr dazu <a href="https://edurata.com/pricing?lang=de" target="_blank">hier im Preismodell</a>):
            </p>

            <ul>
              <li><strong>Keine Entwicklungskosten</strong> ‚Äì wir gehen in Vorleistung, Sie zahlen erst im Betrieb.</li>
              <li><strong>Abrechnung nach Nutzung</strong> ‚Äì je nach automatisierter Menge weit <strong>unter 1 ‚Ç¨ pro Ausf√ºhrung</strong>.</li>
              <li><strong>Skalierbar mit Mengenrabatten</strong> ‚Äì <strong>bis zu 70 % Ersparnis</strong> m√∂glich bei hohem Volumen.</li>
            </ul>

            <p>
              Ein Beispiel aus der Praxis:<br>
              üìÑ <a href="https://edurata.com/blog/sueddeutscher-reifenhaendler-edurata-abholbevollmaechtigung-autohaeuser-automatisiert?lang=de" target="_blank"><strong>Wie ein s√ºddeutscher H√§ndler Prozesse automatisiert hat</strong></a>
            </p>

            <p>
              Ich melde mich gerne nach einiger Zeit nochmal ‚Äì und wenn vorher schon eine Idee aufkommt,
              bei der wir unterst√ºtzen k√∂nnen, freue ich mich √ºber eine kurze Nachricht.
            </p>

            <p>
              Viele Gr√º√üe<br><br>
              <strong>Julian de Mourgues</strong><br>
              Gesch√§ftsf√ºhrer ‚Äì Edurata GmbH
            </p>

            <p>
              üìß <a href="mailto:juliandemourgues@edurata.com">juliandemourgues@edurata.com</a><br>
              üìû +49 1520 2787043<br>
              üåê <a href="https://www.edurata.com/?lang=de" target="_blank">www.edurata.com</a>
            </p>
          </body>
          </html>
      attachments:
        - ${files.Unternehmenspr√§sentation.pdf}
      createDraft: true
  send-first-followup-email:
    foreach: ${list-leads-first-followup.response.records}
    description: Send first follow-up email to leads contacted 3 days ago
    source:
      repoUrl: https://github.com/Edurata/edurata-functions.git
      path: etl/load/send-gmail-email
    props:
      GMAIL_API_KEY: ${secrets.G_MAIL}
      userEmail: juliandemourgues@edurata.com
      recipient: ${each.Email}
      subject: "Kurze Nachfrage zu unserem Gespr√§ch"
      body: |
        <!DOCTYPE html>
          <html lang="de">
          <head>
            <meta charset="utf-8">
            <title>Kurze Nachfrage zu unserem Gespr√§ch</title>
          </head>
          <body style="font-family: Arial, sans-serif; font-size: 14px; line-height: 1.6; color: #000;">
            <p><strong>Betreff:</strong> Kurze Nachfrage zu unserem Gespr√§ch</p>

            <p>Hallo ${each["Name Entscheider"]},</p>

            <p>
              ich hoffe, Sie hatten Zeit, sich unsere Pr√§sentation anzusehen. Haben Sie bereits eine erste Einsch√§tzung,
              ob unsere L√∂sung f√ºr Ihr Unternehmen interessant sein k√∂nnte?
            </p>

            <p>
              Falls Sie noch Fragen haben oder gerne ein konkretes Beispiel f√ºr Ihren spezifischen Anwendungsfall
              besprechen m√∂chten, k√∂nnen wir gerne einen kurzen Termin vereinbaren.
            </p>

            <p>
              Alternativ k√∂nnen Sie mir auch gerne eine kurze Nachricht schreiben, wenn Sie weitere Informationen ben√∂tigen.
            </p>

            <p>
              Viele Gr√º√üe<br><br>
              <strong>Julian de Mourgues</strong><br>
              Gesch√§ftsf√ºhrer ‚Äì Edurata GmbH
            </p>

            <p>
              üìß <a href="mailto:juliandemourgues@edurata.com">juliandemourgues@edurata.com</a><br>
              üìû +49 1520 2787043<br>
              üåê <a href="https://www.edurata.com/?lang=de" target="_blank">www.edurata.com</a>
            </p>
          </body>
          </html>
      createDraft: true
  send-second-followup-email:
    foreach: ${list-leads-second-followup.response.records}
    description: Send second follow-up email to leads contacted 3 days ago
    source:
      repoUrl: https://github.com/Edurata/edurata-functions.git
      path: etl/load/send-gmail-email
    props:
      GMAIL_API_KEY: ${secrets.G_MAIL}
      userEmail: juliandemourgues@edurata.com
      recipient: ${each.Email}
      subject: "Letzte Nachfrage - Edurata Automatisierung"
      body: |
        <!DOCTYPE html>
          <html lang="de">
          <head>
            <meta charset="utf-8">
            <title>Letzte Nachfrage - Edurata Automatisierung</title>
          </head>
          <body style="font-family: Arial, sans-serif; font-size: 14px; line-height: 1.6; color: #000;">
            <p><strong>Betreff:</strong> Letzte Nachfrage - Edurata Automatisierung</p>

            <p>Hallo ${each.Name Entscheider},</p>

            <p>
              ich m√∂chte Sie nicht weiter bel√§stigen, aber da unser Gespr√§ch sehr vielversprechend war,
              wollte ich noch einmal nachfragen, ob Sie Interesse an einer Zusammenarbeit haben.
            </p>

            <p>
              Falls Sie aktuell nicht an einer Automatisierung interessiert sind, ist das v√∂llig in Ordnung.
              Ich w√ºrde mich freuen, wenn Sie sich bei zuk√ºnftigen Projekten an uns erinnern.
            </p>

            <p>
              Falls Sie doch noch Fragen haben oder ein konkretes Projekt besprechen m√∂chten,
              k√∂nnen Sie mich gerne jederzeit kontaktieren.
            </p>

            <p>
              Vielen Dank f√ºr Ihre Zeit und alles Gute f√ºr Ihr Unternehmen!<br><br>
              <strong>Julian de Mourgues</strong><br>
              Gesch√§ftsf√ºhrer ‚Äì Edurata GmbH
            </p>

            <p>
              üìß <a href="mailto:juliandemourgues@edurata.com">juliandemourgues@edurata.com</a><br>
              üìû +49 1520 2787043<br>
              üåê <a href="https://www.edurata.com/?lang=de" target="_blank">www.edurata.com</a>
            </p>
          </body>
          </html>
      createDraft: true
  update-initial-status:
    foreach: ${send-initial-email}
    if:
      "!!": ${each.id}
    description: Mark Email Status as '1. Verschickt' for initial emails
    source:
      repoUrl: https://github.com/Edurata/edurata-functions.git
      path: general/axios
    props:
      method: PATCH
      url: "https://api.airtable.com/v0/${inputs.airtable_id}/${each.id}"
      headers:
        Authorization: "Bearer ${secrets.AIRTABLE_API_KEY}"
        Content-Type: "application/json"
      data:
        fields:
          Email Status: "1. Verschickt"
  update-first-followup-status:
    foreach: ${send-first-followup-email}
    if:
      "!!": ${each.id}
    description: Mark Email Status as '2. Verschickt' for first follow-up emails
    source:
      repoUrl: https://github.com/Edurata/edurata-functions.git
      path: general/axios
    props:
      method: PATCH
      url: "https://api.airtable.com/v0/${inputs.airtable_id}/${each.id}"
      headers:
        Authorization: "Bearer ${secrets.AIRTABLE_API_KEY}"
        Content-Type: "application/json"
      data:
        fields:
          Email Status: "2. Verschickt"
  update-second-followup-status:
    foreach: ${send-second-followup-email}
    if:
      "!!": ${each.id}
    description: Mark Email Status as '3. Verschickt' for second follow-up emails
    source:
      repoUrl: https://github.com/Edurata/edurata-functions.git
      path: general/axios
    props:
      method: PATCH
      url: "https://api.airtable.com/v0/${inputs.airtable_id}/${each.id}"
      headers:
        Authorization: "Bearer ${secrets.AIRTABLE_API_KEY}"
        Content-Type: "application/json"
      data:
        fields:
          Email Status: "3. Verschickt"

